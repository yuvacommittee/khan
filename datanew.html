<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SmartPDS Auto Dashboard</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{
font-family:Arial;
background:linear-gradient(135deg,#667eea,#764ba2);
margin:0;
padding:20px;
}
.container{
max-width:900px;
margin:auto;
background:white;
padding:30px;
border-radius:15px;
box-shadow:0 15px 40px rgba(0,0,0,0.2);
}
h1{text-align:center;}
input,select,button{
padding:12px;
font-size:16px;
margin:5px;
border-radius:8px;
border:2px solid #667eea;
}
button{
background:#ff9800;
color:white;
border:none;
cursor:pointer;
}
button:hover{opacity:0.9;}
.card{
background:#f1f3f4;
padding:15px;
margin:10px 0;
border-radius:10px;
}
.loading{text-align:center;font-size:18px;}
table{
width:100%;
border-collapse:collapse;
margin-top:20px;
}
th,td{
border:1px solid #ddd;
padding:8px;
text-align:center;
}
th{background:#667eea;color:white;}
</style>
</head>
<body>

<div class="container">
<h1>ðŸ“Š SmartPDS Auto Dashboard</h1>

<input type="text" id="fps" placeholder="Enter FPS ID">
<select id="month">
<option value="1">Jan</option>
<option value="2">Feb</option>
<option value="3">Mar</option>
<option value="4">Apr</option>
<option value="5">May</option>
<option value="6">Jun</option>
<option value="7">Jul</option>
<option value="8">Aug</option>
<option value="9">Sep</option>
<option value="10">Oct</option>
<option value="11">Nov</option>
<option value="12">Dec</option>
</select>

<select id="year">
<option>2024</option>
<option>2025</option>
<option selected>2026</option>
</select>

<button onclick="loadData()">Fetch</button>

<div id="dashboard"></div>
</div>

<script>

const PROXY_URL="https://script.google.com/macros/s/AKfycbwc9ID_BPnlHgdFjomDbKx9h8kCwPSXPcHDafUobHE/exec";

async function loadData(){

const fps=document.getElementById("fps").value.trim();
const month=document.getElementById("month").value;
const year=document.getElementById("year").value;

if(!fps){alert("Enter FPS ID");return;}

document.getElementById("dashboard").innerHTML="<div class='loading'>Loading...</div>";

try{

const response=await fetch(`${PROXY_URL}?fpsId=${fps}&month=${month}&year=${year}`);
const text=await response.text();

if(!text || text.includes("<!DOCTYPE")){
throw new Error("Invalid Response");
}

const data=JSON.parse(text);
buildDashboard(data);

}catch(err){
document.getElementById("dashboard").innerHTML="<div style='color:red;text-align:center;'>Error Loading Data</div>";
console.log(err);
}

}

function buildDashboard(data){

let totalTxn=data.length;
let commodityTotals={};

data.forEach(txn=>{
if(txn.commodityList){
txn.commodityList.forEach(c=>{
let name=c.comm_name_en || "Unknown";
let qty=parseFloat(c.sale_qty)||0;

if(!commodityTotals[name]){
commodityTotals[name]=0;
}
commodityTotals[name]+=qty;
});
}
});

let html="";

html+=`<div class='card'><b>Total Transactions:</b> ${totalTxn}</div>`;

for(let item in commodityTotals){
html+=`<div class='card'><b>${item} Total:</b> ${commodityTotals[item].toFixed(2)} Kg</div>`;
}

html+="<table><tr><th>RC No</th><th>Scheme</th><th>Date</th><th>Commodity</th><th>Qty</th></tr>";

data.forEach(txn=>{
let date=txn.loginTime||"-";
let scheme=txn.schemeShortName||"-";
let rc=txn.existingRcNumber||"-";

if(txn.commodityList){
txn.commodityList.forEach(c=>{
let name=c.comm_name_en||"-";
let qty=c.sale_qty||0;
html+=`<tr>
<td>${rc}</td>
<td>${scheme}</td>
<td>${date}</td>
<td>${name}</td>
<td>${qty}</td>
</tr>`;
});
}
});

html+="</table>";

document.getElementById("dashboard").innerHTML=html;

}

</script>
</body>
</html>
